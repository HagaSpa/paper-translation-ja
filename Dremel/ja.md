# Dremel: Web規模における対話型分析

## 要約
Dremelはネストした読み取り用データに対して、スケーラブルでインタラクティブな、分析用クエリをアドホックに実行するシステムです。
マルチレベルの実行ツリーと列指向データレイアウトを組み合わせることにより、1兆を超える行数を持つテーブルに対して、すぐに集約クエリを実行することができます。
このシステムは数千を超えるCPUと、ペタバイトサイズのデータにスケールし、またgoogleには数千人のユーザがいます。
この論文では、Dremelのアーキテクチャおよび実装を描画し、またDremelがMapReduceベースのコンピューティングをどのように補完するかを説明します。
私たちはネストしたレコードのための新しい列指向の表現について提示し、システムの数千ノードにおける実験について説明します。

## 1. イントロダクション
大規模なデータ分析処理はweb企業や産業界に広まっています。
それは特にビジネスにおける、膨大な量の重要データを集めることが可能な低価格なストレージが要因となっています。
このようなデータをアナリストやエンジニアの手に置くことはますます重要になっています。
インタラクティブな処理のレスポンスにかかる時間は、しばしば定性的な違いが生まれます。
データ探索、モニタリング、オンラインの顧客サポート、高速なプロトタイプ開発、データパイプラインのデバックなどタスクによります。

インタラクティブなデータの分析処理は、大規模で高度な並列処理が必要です。
例えば1テラバイトの圧縮データを1秒で取得することは、今日におけるディスクでは何万台ものハードウェアが必要です。
同様にしてCPUを集中的に使うクエリを数秒で完了するために、千を超えるコアで実行する必要があります。
Googleでは、共有されている汎用機のクラスタを使用して巨大な並列処理を実行しています。
通常クラスタは、多種多様なワークロードを持ち、また複数の異なるハードウェアパラメータを持つ、機器上で動作する多数の分散型アプリケーションをホストしています。
分散型アプリケーションの一部のワーカーは、与えられたタスクの実行に要する時間が、他のワーカーよりも長くなるかもしれません。
または障害やクラスタのマネージメントシステムによる、事前準備処理のせいで完了できないかもしれません。
高速に処理を実行することや耐障害性を高めるためには、失敗したワーカーや障害に対する対処が必須です。

webと計算機科学の世界で使われているデータの多くは、リレーショナルなものではありません。
したがって、それらのドメインでは変更容易なデータモデルが重要です。
プログラム言語で使われているデータ構造は、分散システムによるメッセージ交換、構造化されたドキュメントなどなどです。
これらのデータ構造はネストされた、表現に対して有効です。
Web規模でそのようなデータの正規化や再結合をすることは、通常は禁止されています。
ネストされたデータモデルは、Googleや他のメジャーなWeb企業の報告によると、ほとんどの構造化されたデータ処理の基礎となります。

この論文では汎用クラスタによって共有された、とても巨大なデータセットに対する対話型分析処理をサポートする、Dremelと呼ばれるシステムについて説明します。
従来のデータベースとは異なり、それは「in situ」でネストされたデータに対して操作をすることができます。
「In situ」とは「所定の場所」でデータにアクセスする機能のことで、
例えばGFSのような分散ファイルシステムだったり、BigTableのような他のストレージシステムが含まれます。
Dremelは通常MapReduce処理のジョブが必要なデータに対して、わずかな時間でたくさんのクエリを実行することができます
DremelはMapReduceの代替品としては意図されておらず、またMapReduceのパイプラインの出力を分析したり、大規模な計算処理を迅速にプロトタイプ化するためによく使われています

Dremelは2006年から稼働しており、Google内部で数千人の利用者がいます。
GoogleにてデプロイされたDremelの複数のインスタンスは、数十から数千のノードに及びます。
例えば以下のようなシステムで使われています:
- クロールして取得したWebドキュメントの分析
- Android市場における、アプリケーションのインストールデータの追跡
- Google製品の障害報告
- Google Bookからの光学文字認識の結果
- スパムの分析
- Google Mapのデバック
- 管理されたBigTableのTabletの移行
- Googleの分散システム上でのテスト実行の結果
- 数千のディスクにおけるI/O情報の統計
- Googleのデータセンタ内のリソース管理のジョブ実行
- Googleのコードベースのシンボルと依存関係

DremelはWeb検索や並列DBMSから着想を得ています。
まず第一に、Dremelのアーキテクチャは分散型検索エンジンで使われている、サービングツリーのコンセプトを受けています。
ちょうどWeb検索のリクエストのように、クエリはツリーにプッシュされ、それぞれのステップで書き換えられます。
クエリの実行結果は低レベルのツリーから受け取ったレスポンスを集約することで、組み立てられています
次にDremelはアドホックなクエリを表現するために、高レベルなSQL言語に似た言語を提供します。
PigやHiveのようなレイヤとは対照的に、DremelはクエリをMapReduceのジョブに変換せずに、ネイティブ（生）な状態でクエリを実行します。

最後に重要なことですが、Dremelは列指向ストレージ表現を使います。
そのためセカンダリのストレージからより少ないのデータ量を読み取り、簡素な圧縮を行うことでCPUコストを削減できます
列指向のデータストアは、リレーショナルなデータに対する分析のために採用されましたが、
我々の知る限りそれはネストされたデータモデルのために拡張されていません。
私たちが推すカラム指向ストレージのフォーマットは、MapReduceやSawzallやFlumeJavaなどにも含まれています。

この論文では私たちは以下の内容について貢献します:
- ネストされたデータのための、新しい列指向ストレージ形式を紹介します。
ネストされたレコードを列単位で分解し、再度組み立て直すアルゴリズムも提示します。(セクション4)
- Dremelのクエリ言語と実行の概要について説明します。
どちらについても列が多いネストされたデータを効率的に処理するように設計されており、データをレコード形式に再構築することを必要としません。(セクション5)
- Web検索システムで使用されている実行木をデータベース処理に適用する方法と、集計クエリを効率的に実行できる利点について説明します。(セクション6)
- 1兆のレコードやマルチテラバイトのデータセットに対して、1000~4000ノードのインスタンス上で行われた実験について説明します。(セクション7)

この論文の構成は次の通りです。
セクション2では、Dremelと他のデータマネジメントツールをどのように組み合わせて使用するかを説明します。
データモデルについての説明はセクション3で行います。
セクション4~8では、上記で述べられている主な貢献について説明します。
関連する作業についてセクション9で議論します。
セクション10は結論です。


## 2.背景
まず初めに対話式のクエリ処理が、広範なデータ管理エコシステムにどのように適合するかを示すシナリオを説明します。
アリスはGoogleで働くエンジニアで、Webページから新しい種類のパラメータを抜き出す、斬新なアイデアを思いついた場合を例にします。
入力データを処理して、新しいパラメータを含むデータセットを作成するMapReduceのジョブを実行し、
分散システム上のファイルシステムに数十億のレコードとして格納しました。
実験の結果を分析するために、Dremelを起動し以下のコマンドを実行します:

```
DEFINE TABLE t AS /path/to/data/*
SELECT TOP(signal1, 100), COUNT(*) FROM t
```

彼女のコマンドは数秒で実行されます
彼女はアルゴリズムが動くことを確信するために、他のクエリをいくつか実行させます。
彼女は出力されたデータセットに対して、複雑な分析の計算を実行するためのFlumeJavaで書かれたプログラムでsignal1の不規則性を探します。
問題を修正したのち、彼女は入力データを継続して処理するパイプラインを設定します。
彼女はパイプラインの結果を様々なディメンションに集約する、いくつかのSQLクエリをテンプレート化し、それを対話型ダッシュボードに実装します。
最後に彼女はカタログ内の新しいデータセットを更新し、それから他のエンジニアが探索し、クエリを実行できるようにします。

